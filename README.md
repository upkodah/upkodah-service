# 매물을 찾는 메인 알고리즘
목적지에서 사용자로부터 입력된 시간에 갈 수 있는 매물들을 표시해주는 메인 알고리즘 부분입니다.

## **버스 정류장 결과 출력**


### api 서비스키

서비스키로 아래의 2가지가 사용됩니다.
```
my_api_key = unquote('bhQZulxZSz%2FeMsDseMe2DSccTVB%2BQPnxTxDp4SrK7HYRP%2BS0YDiBn93FLz0d%2FMFbyMPUqAvaMqrtW4e9%2FnHYhA%3D%3D')
service_key = "SVpCy0bvZ5pGxpQdz6HmdUFgFl5L6vUbmK9tzQAPslFjjRHSBsKGTvYAkRC84aHoeUct2mtsiD8YfWyEzOQMIQ%3D%3D"
```

### 1. 목적지 근처의 버스 정류장 찾기
https://www.data.go.kr/tcs/dss/selectApiDataDetailView.do?publicDataPk=15000759

목적지의 gps 좌표를 기반으로 근처의 버스 정류장의 gps를 반환하는 공공데이터 api를 사용합니다.

### 2. 버스 노선 데이터 받기
https://www.data.go.kr/tcs/dss/selectApiDataDetailView.do?publicDataPk=15000193

공공데이터 api를 호출하여 버스 노선 데이터 중 아래의 데이터를 데이터 프레임으로 저장합니다.
```
'진행방향', '순번', '구간ID', '정류소ID', '정류소번호', '정류장이름', 'gpsX', 'gpsY', '구간속도', '구간거리'
```

### 3. 두 버스 정류장 사이의 시간 구하기
https://www.data.go.kr/tcs/dss/selectApiDataDetailView.do?publicDataPk=15000414

목적지에서 가까운 버스 정류장과 목표로 하는 매물에 가까운 버스 정류장 사이의 이동 시간을 구하기 위해 공공데이터 포털의 대중교통환승경로 조회 서비스 api를 이용합니다.
환승을 고려하지 않고 가는 경우만을 생각하기 때문에 처음 탑승했던 버스 노선과 환승 횟수를 기준으로 필터링하여 원하는 목적지의 버스 정류장을 반환합니다.


### 4. 목적지에서 입력된 시간에 갈 수 있는 버스 정류장의 gps 반환
* 1번을 통해 목적지 근처 버스 정류장의 gps 값을 얻습니다.

* 1번과 2번을 통해 목적지 근처 버스 정류장의 버스 노선 데이터를 데이터 프레임으로 받습니다.

* 2번과 3번을 통해 목적지에서 입력된 시간에 갈 수 있는 버스 정류장의 gps를 반환합니다.
> 여기에서 다음과 같은 사항을 고려합니다.
>
> 버스 진행방향을 통해 버스가 회차하여 가고있는 곳을 지정하지 않았는지 확인합니다.
>
> 버스 한 구간의 시간은 구간거리 / 구간속도로 구합니다.
>
> 서울시에 국한되어 사용되는 api이기 때문에 제외시켜야하는 버스 노선이 존재합니다.
>

### 5. 반환 받은 버스 정류장이 존재하는 그리드 획득
4번에서 얻은 버스 정류장의 gps를 가지고 그리드를 나누는 코드를 호출하여 해당 gps가 어느 그리드에 해당하는지 반환합니다.
  
&nbsp;&nbsp;  
&nbsp;&nbsp; 
  
## **지하철역 결과 출력**

### 지하철 목록 입력
```
subway_route = [['1호선', '온수역', '2'], ['1호선', '오류동역', '3'], ['1호선', '개봉역', '2'], ['1호선', '구일역', '2'], 
                ['1호선', '구로역', '3'], ['1호선', '신도림역', '2'], ['1호선', '영등포역', '2'], ['1호선', '신길역', '2'], 
                ['1호선', '대방역', '2'], ['1호선', '노량진역', '3'], ['1호선', '용산역', '3'], ['1호선', '남영역', '3'], 
                ['1호선', '서울역', '3'], ['1호선', '시청역', '2'],['1호선', '종각역', '3'], ['1호선', '종로3가역', '1'], 
                ['1호선', '종로5가역', '2'], ['1호선', '동대문역', '2'], ['1호선', '동묘앞역', '1'], ['1호선', '신설동역', '2'],
                ['1호선', '제기동역', '2'], ['1호선', '청량리역', '2'], ['1호선', '회기역', '2'], ['1호선', '외대앞역', '2'], 
                ['1호선', '신이문역', '2'], ['1호선', '석계역', '3'], ['1호선', '광운대역', '2'],['1호선', '월계역', '3'], 
                ['1호선', '녹천역', '2'], ['1호선', '창동역', '2'], ['1호선', '방학역', '3'], ['1호선', '도봉역', '2'], 
                ['1호선', '도봉산역', '2'], ['2호선', '을지로입구역', '2'], ...
```
주소가 서울인 지하철역만을 따로 저장했습니다. 

['지하철 노선', '지하철 역명', '다음 정류장까지 걸리는 시간'] 으로 구성되어 있습니다

### api 서비스키

카카오 api 서비스키와 공공데이터 포털 api 서비스키 2가지가 사용됩니다
```
station_api_key = 'KakaoAK 2923b1b707b4bddd84bbc07c7bb3f14a'
my_api_key = unquote('bhQZulxZSz%2FeMsDseMe2DSccTVB%2BQPnxTxDp4SrK7HYRP%2BS0YDiBn93FLz0d%2FMFbyMPUqAvaMqrtW4e9%2FnHYhA%3D%3D')
```

### 주변의 지하철역 찾기

```
def get_near_station_gps(self, gps_x, gps_y):
    ...
    return gps_x_list, gps_y_list, name_list, distance
```

카카오 api를 통해 주변의 지하철역과 역의 이름, 지하철역까지의 거리를 반환받습니다.

### 지하철역의 gps 검색
```
def get_station_gps(self, station):
    ...
    return gps_x, gps_y
```

'[지하철 역] [지하철 노선명]' 을 입력 받아 지하철 역의 gps를 반환합니다.

### 목적지에서 입력된 시간에 갈 수 있는 지하철역의 gps 반환

```
def result_sub_station(self):
    ...
    return  result_gps
```
사용자로부터 입력된 gps를 받아 주변의 지하철역을 찾습니다.  
사용자로부터 입력받은 시간에서 지하철역까지의 도보 이동시간을 뺀 후 해당 시간에 환승없이 갈 수 있는 지하철역을 검색합니다.  
저장된 ```subway_route```에서 한 정거장씩 이동시간을 추가해가며 입력된 시간이 초과했는지 확인하여 초과하기 전 단계의 지하철역을 반환합니다.  
반환받은 지하철역의 gps를 검색하여 결과값으로 반환합니다.
